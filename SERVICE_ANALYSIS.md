# –ê–Ω–∞–ª–∏–∑ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ MC-FRIENDS

## –û–±–∑–æ—Ä

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å MC-FRIENDS –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥—Ä—É–∂–±–æ–π –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏. –û–Ω –≤–∫–ª—é—á–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏, –ø—Ä–∏–Ω—è—Ç–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞—è–≤–æ–∫ –Ω–∞ –¥—Ä—É–∂–±—É, –∞ —Ç–∞–∫–∂–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥—Ä—É–∑–µ–π.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
mc-friends/
‚îú‚îÄ‚îÄ .gitlab-ci.yml          # CI/CD –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è GitLab
‚îú‚îÄ‚îÄ Dockerfile              # Docker –æ–±—Ä–∞–∑ –¥–ª—è —Å–±–æ—Ä–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ pom.xml                 # Maven –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ README.md               # –®–∞–±–ª–æ–Ω–Ω—ã–π README (–Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω)
‚îî‚îÄ‚îÄ src/main/
    ‚îú‚îÄ‚îÄ java/com/example/mcfriends/
    ‚îÇ   ‚îú‚îÄ‚îÄ McFriendsApplication.java      # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    ‚îÇ   ‚îú‚îÄ‚îÄ client/
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AccountServiceClient.java  # Feign –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
    ‚îÇ   ‚îú‚îÄ‚îÄ config/
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ OpenApiConfig.java         # Swagger/OpenAPI –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    ‚îÇ   ‚îú‚îÄ‚îÄ controller/
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ FriendshipController.java  # REST –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
    ‚îÇ   ‚îú‚îÄ‚îÄ dto/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AccountDto.java            # DTO –∞–∫–∫–∞—É–Ω—Ç–∞
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FriendDto.java             # DTO –¥—Ä—É–≥–∞
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FriendRequestDto.java      # DTO –∑–∞—è–≤–∫–∏ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è!)
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ NotificationEvent.java     # –°–æ–±—ã—Ç–∏–µ –¥–ª—è Kafka
    ‚îÇ   ‚îú‚îÄ‚îÄ exception/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GlobalExceptionHandler.java    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ResourceNotFoundException.java # –ö–∞—Å—Ç–æ–º–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
    ‚îÇ   ‚îú‚îÄ‚îÄ model/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Friendship.java            # JPA —Å—É—â–Ω–æ—Å—Ç—å
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ FriendshipStatus.java      # Enum —Å—Ç–∞—Ç—É—Å–æ–≤
    ‚îÇ   ‚îú‚îÄ‚îÄ repository/
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ FriendshipRepository.java  # JPA —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
    ‚îÇ   ‚îú‚îÄ‚îÄ security/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ JwtAuthFilter.java         # JWT —Ñ–∏–ª—å—Ç—Ä
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SecurityConfig.java        # Spring Security –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    ‚îÇ   ‚îî‚îÄ‚îÄ service/
    ‚îÇ       ‚îú‚îÄ‚îÄ FriendshipService.java     # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
    ‚îÇ       ‚îî‚îÄ‚îÄ KafkaProducerService.java  # Kafka –ø—Ä–æ–¥—é—Å–µ—Ä
    ‚îî‚îÄ‚îÄ resources/
        ‚îú‚îÄ‚îÄ application.yml                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        ‚îú‚îÄ‚îÄ prometheus.yml                  # Prometheus –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        ‚îî‚îÄ‚îÄ db/changelog/                   # Liquibase –º–∏–≥—Ä–∞—Ü–∏–∏
            ‚îú‚îÄ‚îÄ db.changelog-master.xml
            ‚îî‚îÄ‚îÄ 2025-11-16-01-create-friendships-table.xml
```

---

## üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –í–µ—Ä—Å–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|--------|----------|
| Java | 21 | –Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è |
| Spring Boot | 3.2.0 | –§—Ä–µ–π–º–≤–æ—Ä–∫ |
| Spring Cloud | 2023.0.0 | –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã |
| Spring Data JPA | - | –†–∞–±–æ—Ç–∞ —Å –ë–î |
| Spring Security | - | –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å |
| Spring Kafka | - | –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π |
| PostgreSQL | - | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö |
| Liquibase | - | –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î |
| Eureka Client | - | Service Discovery |
| OpenFeign | - | HTTP –∫–ª–∏–µ–Ω—Ç |
| springdoc-openapi | 2.5.0 | Swagger UI |
| Lombok | 1.18.30 | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ |
| jjwt | 0.11.5 | JWT —Ç–æ–∫–µ–Ω—ã |

---

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞** - –ø—Ä–æ–µ–∫—Ç –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É Spring Boot –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. **Docker –æ–±—Ä–∞–∑** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π multi-stage Dockerfile –¥–ª—è —Å–±–æ—Ä–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞
3. **CI/CD Pipeline** - –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π GitLab CI/CD –¥–ª—è —Å–±–æ—Ä–∫–∏, push –∏ –¥–µ–ø–ª–æ—è
4. **Liquibase –º–∏–≥—Ä–∞—Ü–∏—è** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü—ã `friendships`
5. **Swagger UI** - OpenAPI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
6. **Eureka Client** - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Service Discovery
7. **Prometheus/Actuator** - –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 1. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ç–µ—Å—Ç—ã**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –í –ø—Ä–æ–µ–∫—Ç–µ –Ω–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `src/test` –∏ –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
- **–í–ª–∏—è–Ω–∏–µ**: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ª–æ–≥–∏–∫–∏, –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ —Ä–µ–≥—Ä–µ—Å—Å–∏–π
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å unit –∏ integration —Ç–µ—Å—Ç—ã

### 2. **–ñ—ë—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á JWT**
```java
// JwtAuthFilter.java:25
private final String SECRET_KEY = "YourSharedSuperSecretKeyForJWTSignature";
```
- **–ü—Ä–æ–±–ª–µ–º–∞**: –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ–¥–µ, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **–í–ª–∏—è–Ω–∏–µ**: –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø —É—è–∑–≤–∏–º–æ—Å—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **–†–µ—à–µ–Ω–∏–µ**: –í—ã–Ω–µ—Å—Ç–∏ –≤ `application.yml` —Å `${JWT_SECRET}` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Vault

### 3. **Hardcoded User ID –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ**
```java
// FriendshipController.java:23-28
private UUID extractUserId(String userIdHeader) {
    if (userIdHeader == null || userIdHeader.isBlank()) {
        return UUID.fromString("00000000-0000-0000-0000-000000000001");
    }
    return UUID.fromString(userIdHeader);
}
```
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞ X-USER-ID –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–π ID
- **–í–ª–∏—è–Ω–∏–µ**: –õ—é–±–æ–π –∑–∞–ø—Ä–æ—Å –±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –æ—Ç –∏–º–µ–Ω–∏ –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–†–µ—à–µ–Ω–∏–µ**: –í—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –µ—Å–ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

### 4. **–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –æ—Ç–∫—Ä—ã—Ç—ã –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**
```java
// SecurityConfig.java:36
"/api/v1/friends/**"  // –í –±–µ–ª–æ–º —Å–ø–∏—Å–∫–µ!
```
- **–ü—Ä–æ–±–ª–µ–º–∞**: –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥—Ä—É–∑–µ–π –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ whitelist –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- **–í–ª–∏—è–Ω–∏–µ**: –õ—é–±–æ–π –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥–µ–π—Å—Ç–≤–∏—è —Å –¥—Ä—É–∑—å—è–º–∏ –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–†–µ—à–µ–Ω–∏–µ**: –£–±—Ä–∞—Ç—å `/api/v1/friends/**` –∏–∑ `AUTH_WHITELIST`

### 5. **–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ö–ª—é—á "YourSharedSuperSecretKeyForJWTSignature" (37 —Å–∏–º–≤–æ–ª–æ–≤) –¥–ª—è HMAC-SHA
- **–í–ª–∏—è–Ω–∏–µ**: –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∑–ª–æ–º–∞–Ω
- **–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–ª—é—á –º–∏–Ω–∏–º—É–º 256 –±–∏—Ç (32 –±–∞–π—Ç–∞) –¥–ª—è HS256

---

## ‚ö†Ô∏è –õ–û–ì–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò

### 1. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫**
```java
// FriendshipService.java:33-40
public Friendship sendFriendRequest(UUID initiatorId, UUID targetId) {
    Friendship request = new Friendship();
    request.setUserIdInitiator(initiatorId);
    request.setUserIdTarget(targetId);
    request.setStatus(FriendshipStatus.PENDING);
    request.setCreatedAt(LocalDateTime.now());
    return friendshipRepository.save(request);
}
```
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∑–∞—è–≤–æ–∫ –æ–¥–Ω–æ–º—É –∏ —Ç–æ–º—É –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–≤—è–∑–∏ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º

### 2. **–ù–µ–ª—å–∑—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É —Å–∞–º–æ–º—É —Å–µ–±–µ**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ `initiatorId != targetId`
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é

### 3. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å—Ç—å —Å—Ç–∞—Ç—É—Å `DECLINED`, –Ω–æ –Ω–µ—Ç –º–µ—Ç–æ–¥–∞ –¥–ª—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∑–∞—è–≤–∫–∏
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å endpoint `PUT /requests/{requestId}/decline`

### 4. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å—Ç—å —Å—Ç–∞—Ç—É—Å `BLOCKED`, –Ω–æ –Ω–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å endpoint –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

### 5. **FriendRequestDto –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**
```java
// FriendRequestDto.java - —Å–æ–∑–¥–∞–Ω, –Ω–æ –Ω–∏–≥–¥–µ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è
public class FriendRequestDto {
    private UUID targetUserId;
}
```
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ú—ë—Ä—Ç–≤—ã–π –∫–æ–¥
- **–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å

### 6. **–ù–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –≤ —Å–ø–∏—Å–∫–µ –¥—Ä—É–∑–µ–π**
```java
// FriendshipController.java:51-58
@GetMapping
public ResponseEntity<List<FriendDto>> getFriendsList(...)
```
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –¥—Ä—É–∑–µ–π –≤–µ—Ä–Ω—ë—Ç—Å—è –≤–µ—Å—å —Å–ø–∏—Å–æ–∫
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å `Pageable` –∏ –≤–µ—Ä–Ω—É—Ç—å `Page<FriendDto>`

### 7. **–ù–µ—Ç endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞—è–≤–æ–∫**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –∑–∞—è–≤–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –µ–º—É –æ—Ç–ø—Ä–∞–≤–∏–ª–∏
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å `GET /requests/incoming`

### 8. **–ù–µ—Ç endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ö–æ–¥—è—â–∏—Ö –∑–∞—è–≤–æ–∫**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å —Å–≤–æ–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å `GET /requests/outgoing`

---

## üîÑ –ü–†–û–ë–õ–ï–ú–´ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò

### 1. **–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ—Ä—Ç–æ–≤**
| –§–∞–π–ª | –ü–æ—Ä—Ç |
|------|------|
| application.yml | 8083 |
| Dockerfile | 8092 |
| .gitlab-ci.yml | 8092 |

- **–ü—Ä–æ–±–ª–µ–º–∞**: –í application.yml —É–∫–∞–∑–∞–Ω –ø–æ—Ä—Ç 8083, –∞ –≤ Dockerfile –∏ CI/CD - 8092
- **–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é

### 2. **Kafka bootstrap —Å–µ—Ä–≤–µ—Ä localhost**
```yaml
# application.yml
kafka:
  bootstrap-servers: localhost:9092
```
- **–ü—Ä–æ–±–ª–µ–º–∞**: –í production –Ω—É–∂–µ–Ω —Ä–µ–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å Kafka
- **–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}`

### 3. **Eureka URL localhost**
```yaml
eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka/
```
- **–ü—Ä–æ–±–ª–µ–º–∞**: –í production –Ω—É–∂–µ–Ω —Ä–µ–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å Eureka
- **–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 4. **Prometheus –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ resources**
- **–ü—Ä–æ–±–ª–µ–º–∞**: `prometheus.yml` –≤ —Ä–µ—Å—É—Ä—Å–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª–∞ (—ç—Ç–æ –¥–ª—è Prometheus —Å–µ—Ä–≤–µ—Ä–∞)
- **–†–µ—à–µ–Ω–∏–µ**: –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –≤—ã–Ω–µ—Å—Ç–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

### 5. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Prometheus metrics –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ**
```yaml
# application.yml - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–µ–∑–∞–Ω—ã
management:
  metrics:
    export:
      prometheus:
        # –Ω–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ enabled: true
```

---

## üìä –ù–ï–°–û–û–¢–í–ï–¢–°–¢–í–ò–Ø –í CI/CD

### 1. **–ò–º—è Docker –æ–±—Ä–∞–∑–∞ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–µ—Ä–≤–∏—Å—É**
```yaml
# .gitlab-ci.yml:17
DOCKER_IMAGE: $DOCKER_HUB_USER/mc-admin  # –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å mc-friends!
```

### 2. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ Admin Bot Service**
```yaml
# .gitlab-ci.yml:1
# GitLab CI/CD Pipeline for Admin Bot Service  # –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å Friends Service
```

### 3. **Telegram –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ –Ω—É–∂–Ω—ã**
```yaml
# .gitlab-ci.yml:11-13
# - TELEGRAM_BOT_TOKEN
# - TELEGRAM_BOT_USERNAME
# - ADMIN_WHITELIST
```
- –≠—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ Friends —Å–µ—Ä–≤–∏—Å–µ

---

## üìã –û–¢–°–£–¢–°–¢–í–£–Æ–©–ò–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ

1. **–ü–æ–∏—Å–∫ –¥—Ä—É–∑–µ–π** - –Ω–µ—Ç endpoint –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥—Ä—É–∑–µ–π** - –Ω–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
3. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥—Ä—É–∑–µ–π** - –Ω–µ—Ç endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—Ä—É–∂–±—ã** - –Ω–µ—Ç endpoint `GET /friends/{userId}/check`
5. **–û–±—â–∏–µ –¥—Ä—É–∑—å—è** - –Ω–µ—Ç endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±—â–∏—Ö –¥—Ä—É–∑–µ–π
6. **–û—Ç–º–µ–Ω–∞ –∑–∞—è–≤–∫–∏** - –Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–º–µ–Ω–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –∑–∞—è–≤–∫—É
7. **–ò—Å—Ç–æ—Ä–∏—è –¥—Ä—É–∂–±—ã** - –Ω–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å–∞

---

## üìê –ë–ê–ó–ê –î–ê–ù–ù–´–•

### –¢–µ–∫—É—â–∞—è —Å—Ö–µ–º–∞ (Liquibase):
```sql
CREATE TABLE friendships (
    id UUID PRIMARY KEY,
    user_id_initiator UUID NOT NULL,
    user_id_target UUID NOT NULL,
    status VARCHAR(20) NOT NULL,
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP,
    UNIQUE (user_id_initiator, user_id_target)
);
```

### –ü—Ä–æ–±–ª–µ–º—ã:
1. **–ù–µ—Ç –∏–Ω–¥–µ–∫—Å–æ–≤** - –∑–∞–ø—Ä–æ—Å—ã –ø–æ user_id_initiator –∏ user_id_target –±—É–¥—É—Ç –º–µ–¥–ª–µ–Ω–Ω—ã–º–∏
2. **–ù–µ—Ç foreign keys** - –Ω–µ—Ç —Å–≤—è–∑–∏ —Å —Ç–∞–±–ª–∏—Ü–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–Ω–æ —ç—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞)

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã:
```sql
CREATE INDEX idx_friendships_initiator ON friendships(user_id_initiator);
CREATE INDEX idx_friendships_target ON friendships(user_id_target);
CREATE INDEX idx_friendships_status ON friendships(status);
```

---

## üîí –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏:

| –£—Ä–æ–≤–µ–Ω—å | –ü—Ä–æ–±–ª–µ–º–∞ | –§–∞–π–ª |
|---------|----------|------|
| üî¥ CRITICAL | JWT –∫–ª—é—á –≤ –∫–æ–¥–µ | JwtAuthFilter.java:25 |
| üî¥ CRITICAL | –í—Å–µ API –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ | SecurityConfig.java:36 |
| üü† HIGH | Hardcoded User ID | FriendshipController.java:26 |
| üü† HIGH | –ù–µ—Ç rate limiting | - |
| üü° MEDIUM | –ù–µ—Ç CORS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ | - |
| üü° MEDIUM | –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö | - |

---

## üöÄ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ü–†–ò–û–†–ò–¢–ï–¢–ê–ú

### –°—Ä–æ—á–Ω–æ (–¥–æ —Ä–µ–ª–∏–∑–∞):
1. ‚ùó –£–±—Ä–∞—Ç—å `/api/v1/friends/**` –∏–∑ AUTH_WHITELIST
2. ‚ùó –í—ã–Ω–µ—Å—Ç–∏ JWT secret –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. ‚ùó –£–±—Ä–∞—Ç—å hardcoded User ID (–≤—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å 401)
4. ‚ùó –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Ä—Ç –≤ application.yml –Ω–∞ 8092
5. ‚ùó –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏–º—è Docker –æ–±—Ä–∞–∑–∞ –≤ CI/CD

### –í–∞–∂–Ω–æ (—Å–ª–µ–¥—É—é—â–∏–π —Å–ø—Ä–∏–Ω—Ç):
1. ‚ö†Ô∏è –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞—è–≤–æ–∫
2. ‚ö†Ô∏è –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É self-friendship
3. ‚ö†Ô∏è –î–æ–±–∞–≤–∏—Ç—å endpoint –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞—è–≤–æ–∫
4. ‚ö†Ô∏è –î–æ–±–∞–≤–∏—Ç—å endpoint –¥–ª—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∑–∞—è–≤–æ–∫
5. ‚ö†Ô∏è –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –≤ –ë–î

### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ:
1. üìù –ù–∞–ø–∏—Å–∞—Ç—å unit —Ç–µ—Å—Ç—ã
2. üìù –ù–∞–ø–∏—Å–∞—Ç—å integration —Ç–µ—Å—Ç—ã
3. üìù –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é
4. üìù –î–æ–±–∞–≤–∏—Ç—å rate limiting
5. üìù –û–±–Ω–æ–≤–∏—Ç—å README —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π

---

## üìà –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ö–û–î–ê

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| Java —Ñ–∞–π–ª–æ–≤ | 17 |
| DTO –∫–ª–∞—Å—Å–æ–≤ | 4 |
| Endpoints | 4 |
| –¢–µ—Å—Ç–æ–≤ | 0 |
| –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ | 0% |
| –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º | 5 |
| –õ–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ | 8 |
| –ü—Ä–æ–±–ª–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ | 5 |

---

## üîß API ENDPOINTS

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|-------|------|----------|--------|
| POST | `/api/v1/friends/requests/{targetUserId}` | –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| PUT | `/api/v1/friends/requests/{requestId}/accept` | –ü—Ä–∏–Ω—è—Ç—å –∑–∞—è–≤–∫—É | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| GET | `/api/v1/friends` | –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π | ‚ö†Ô∏è –ë–µ–∑ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ |
| DELETE | `/api/v1/friends/{friendId}` | –£–¥–∞–ª–∏—Ç—å –¥—Ä—É–≥–∞ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |

---

## üìù –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Ä–∞–Ω–Ω–µ–π —Å—Ç–∞–¥–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –±–∞–∑–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é. –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å–≤—è–∑–∞–Ω—ã —Å:
1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é** - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º** - –ø–æ–ª–Ω–æ–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ—Å—Ç–æ–≤
3. **–ù–µ–ø–æ–ª–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º** - –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤–∞–∂–Ω—ã–µ endpoint'—ã
4. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π** - –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø–æ—Ä—Ç–æ–≤ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫

–ü–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤ production –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:
1. –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
2. –î–æ–±–∞–≤–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤
3. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
4. –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ endpoint'—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞—è–≤–∫–∞–º–∏
